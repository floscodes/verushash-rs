mod verushash;

pub fn verus_hash(data: &[u8]) -> [u8; 32] {
    let mut out = [0u8; 32];
    unsafe {
        verushash::verus_v1_hash(out.as_mut_ptr(), data.as_ptr(), data.len());
    }
    out
}

pub fn verus_hash_v2(data: &[u8]) -> [u8; 32] {
    let mut out = [0u8; 32];
    unsafe {
        verushash::verus_v2_hash(out.as_mut_ptr(), data.as_ptr(), data.len());
    }
    out
}

pub fn verus_hash_v2_1(data: &[u8]) -> [u8; 32] {
    let mut out = [0u8; 32];
    unsafe {
        verushash::verus_v2_1_hash(out.as_mut_ptr(), data.as_ptr(), data.len());
    }
    out
}

pub fn verus_hash_v2_2(data: &[u8]) -> [u8; 32] {
    let mut out = [0u8; 32];
    unsafe {
        verushash::verus_v2_2_hash(out.as_mut_ptr(), data.as_ptr(), data.len());
    }
    out
}

#[cfg(test)]
mod tests {
    use super::*;
    use hex_literal::hex;

    #[test]
    fn test_hashes() {
        let data = b"hello world";
        let h1 = verus_hash(data);
        let h2 = verus_hash_v2(data);
        assert_ne!(h1, h2); // v1 und v2 sollten unterschiedlich sein
    }

    #[test]
    fn test_verus_hash_full_block_without_solution() {
        // Header-Felder aus dem Block
        let version: u32 = 65540;
        let prev_block = hex!("bcafa421237a33e46ac2cb939005b6e359dfe121a7d463c584196911d37b43d9");
        let merkle_root = hex!("141b9ecdb6d4d4914863ecd156a674f46d967fb1b7373300f897aed3a8f9ca5d");
        let time: u32 = 1769350479;
        let bits = hex!("1b051ad1");
        let nonce = hex!("00001879e030148abae4636109cb6c2350e99c32612dca38e3026c52cd1c3a36");
        let solution = hex!("0700000000010400df9a51597e31d795ebc5b36449cb6badd92ba681ffb1ece444c4329fa0cf390261014cd99d9dc8564a7aed749a20c51e866c700c857437391784cec1dc6625581af5b8015c64d39ab44c60ead8317f9f5a9b6c4c9921b9353ba92bb170eb868fb3b46389b1513b3432e5b3ed11cccefd040b14300100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600085100000000606767bf84f6b01");
        let segid: i32 = -2;
        let final_sapling_root =
            hex!("1de12cea4768068f781817ecf9c4c60d82394e58f7fffce530be6c14bf4d0a42");

        // Serialisiere den Header wie Verus-Core (ohne Solution)
        let mut header_bytes = vec![];
        header_bytes.extend(&version.to_le_bytes());
        header_bytes.extend(&prev_block);
        header_bytes.extend(&merkle_root);
        header_bytes.extend(&time.to_le_bytes());
        header_bytes.extend(&bits);
        header_bytes.extend(&nonce);
        header_bytes.extend(&solution);
        header_bytes.extend(&segid.to_le_bytes());
        header_bytes.extend(&final_sapling_root);

        // Verus Hash Ã¼ber den Header
        let hash_result = verus_hash_v2_2(&header_bytes);

        // Erwarteter Blockhash
        let expected_hash =
            hex!("000000000003212dc93830bbf1fcdf92bcdc0ac3e859dd5b0db454ebd9b18d50");

        assert_eq!(hash_result, expected_hash);
    }
}
